---
title: 浏览器事件循环机制
date: 2023-09-06 15:25:39
tags: ["browser", "review"]
index_img: /img/event-loop-index.jpg
banner_img: /img/event-loop-banner.png
---

## 线程和进程

1. 进程中的任一线程执行出错，都会导致整个进程的崩溃
2. 线程之间共享进程中的数据
3. 当一个进程关闭之后，操作系统会回收进程所占用的内存
4. 进程之间的内容相互隔离

## 多进程架构浏览器

{% asset_img multi-frame.webp multi-frame %}

- 浏览器进程：主要负责界面显示，用户交互，子进程管理，同时提供存储等功能
- 渲染进程：核心任务是将 HTML，CSS 和 js 转换为用户可以与之交互的网页，排版引擎 Blink 和 js 引擎 V8 都是运行在此进程中。chrome 会为每个 tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。
- GPU 进程：网页、Chrome 的 UI 界面都选择采用 GPU 来绘制。
- 网络进程：主要负责页面的网络资源加载。
- 插件进程：主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。

> 缺点
>
> - 更高的资源占用。因为每个进程都会包含公共进出结构的副本
> - 更复杂的体系结构

## 面试回答

首先 js 是单线程运行的，在代码执行的时候会将不同函数的执行上下文压入执行栈中来保证代码的有序执行

在执行同步代码时，如果遇到了异步事件，js 引擎并不会一直等待其返回结果，而是会将这个事件挂起，继续执行执行栈中其他任务

当同步事件执行完毕后，再将异步事件对应的回调加入到与当前执行栈不同的另一个任务队列中等待执行

任务队列可以分为宏任务队列和微任务队列，当当前执行栈中的事情执行完毕后，js 引擎首先会判断微任务队列中是否有任务可以执行，如果有就将微任务队首事件压入栈中执行

当微任务队列中任务都执行完成后再去判断宏任务队列中的任务

## 宏任务

script、 setTimeout、setInterval、I/O、UI render

## 微任务

process.nextTick、promise、Object.observe、MutationObserve
